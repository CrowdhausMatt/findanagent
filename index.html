<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estate Directory</title>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TGNRSQ6QGB"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-TGNRSQ6QGB');
    </script>
    
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@400;700;800&display=swap" rel="stylesheet">
    <style>
    body {
        background-color: #fdfbfb;
        color: #000;
        font-family: 'Prompt', sans-serif;
        text-align: center;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        align-items: center;
        min-height: 100vh;
    }

    .container {
        width: 66%;
        padding: 40px;
        border-radius: 10px;
        background-color: #2E2E2E;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
    }

    .logo {
        position: absolute;
        top: 20px;
        left: 20px;
    }

    .logo img {
        width: 150px;
        height: auto;
    }

    h1 {
        font-size: 9rem;
        font-weight: 800;
        margin: 0;
        line-height: 1.1;
        color: #fdfbfb;
    }

    p {
        font-size: 2rem;
        margin: 20px 0;
        color: #fdfbfb;
    }

    .search-bar {
        margin: 20px 0;
    }

    .search-bar input {
        padding: 15px;
        font-size: 1.2rem;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    .search-bar button {
        padding: 15px 30px;
        font-size: 1.2rem;
        border-radius: 5px;
        border: none;
        background-color: #ffc107;
        color: #333;
        cursor: pointer;
    }

    .register-link {
        margin-top: 10px;
    }

    .register-link a {
        color: #fdfbfb;
        font-size: 0.8rem;
        text-decoration: none;
    }

    .results-container {
        width: 66%;
        margin-top: 20px;
        display: flex;
        flex-direction: column;
        align-items: center;
    }

    .results {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
    }

    .result-item {
        background-color: #ffffff;
        padding: 20px;
        border-radius: 25px;
        text-align: left;
        width: 300px;
        min-height: 500px;
        box-sizing: border-box;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        border: 1px solid #d3d3d3;
        transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
        overflow: hidden;
        position: relative;
    }

    .result-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        border-color: #ffc107;
    }

    .result-item img {
        width: 100%;
        height: 50%;
        border-radius: 20px;
        object-fit: cover;
        margin-bottom: 10px;
    }

    .result-item p {
        font-size: 1rem;
        margin: 5px 0;
        color: #000;
    }

    .result-item p strong {
        font-size: 1rem;
    }

    .about-me {
        display: -webkit-box;
        -webkit-line-clamp: 5;
        -webkit-box-orient: vertical;
        overflow: hidden;
        text-overflow: ellipsis;
        height: 7.5rem;
        white-space: normal;
    }

    .modal {
        display: none;
        position: fixed;
        z-index: 100;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        overflow: auto;
        background-color: rgba(0, 0, 0, 0.4);
    }

    .modal-content {
        background-color: #fefefe;
        margin: 5% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 80%;
        max-width: 600px;
        height: 80%;
        text-align: center;
        border-radius: 20px;
        color: #000;
        overflow-y: auto;
    }

    .modal-content img {
        width: 100%;
        height: 450px;
        object-fit: cover;
        border-radius: 10px;
        margin-bottom: 20px;
    }

    .modal-content p {
        margin: 10px 0;
        color: #000;
        font-size: 0.9rem;
        line-height: 1.4;
    }

    .agent-details {
        font-size: 0.9rem;
        transition: font-size 0.3s ease;
        max-height: 200px;
        overflow-y: auto;
    }

    #noResultsModal .no-results-modal-content p {
        color: #000000 !important;
        font-size: 0.75rem !important;
        line-height: 1.5 !important;
    }

    #noResultsModal .no-results-modal-content {
        background-color: #ffffff;
        margin: 20% auto;
        padding: 20px;
        border: 1px solid #888;
        width: 60%;
        max-width: 400px;
        text-align: center;
        border-radius: 10px;
    }

    .message-btn {
        background-color: #FFC109;
        color: white;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin-top: 10px;
        font-size: 1rem;
    }

    @media only screen and (max-width: 600px) {
        .logo img {
            width: 40px;
            height: auto;
        }

        h1 {
            font-size: 5rem;
        }
    }

    /* Carousel Styles */
    .carousel-container {
        width: 100%;
        overflow: hidden;
        position: relative;
        padding: 10px 0;
        margin-bottom: 10px;
        background-color: #fdfbfb;
    }

    .carousel-row {
        display: flex;
        align-items: center;
        animation: scroll 30s linear infinite;
    }

    .carousel-row.reverse {
        animation-direction: reverse;
    }

    .carousel-item {
        display: flex;
        align-items: center;
        margin: 0 10px; /* Increased margin for even spacing */
    }

    .carousel-item img {
        border-radius: 20px;
        width: 100px;
        height: 100px;
        object-fit: cover;
    }

    @keyframes scroll {
        0% { transform: translateX(100%); }
        100% { transform: translateX(-100%); }
    }

    @media only screen and (max-width: 768px) {
        .carousel-item img {
            width: 80px;
            height: 80px;
        }
    }
    </style>
</head>
<body>
    <div class="logo">
        <img src="logo.png" alt="KnokKnok Logo" />
    </div>

    <div class="container">
        <h1>WHO'S THERE?</h1>
        <p>Find A Top Class Estate Agent In Your Area</p>
        <div class="search-bar">
            <input type="text" id="location" placeholder="Location..." />
            <button onclick="searchAgents()">Search</button>
        </div>
        <div class="register-link">
            <a href="https://airtable.com/appTke8M57IxqdO2N/pagqWWTIzMWlTi3JV/form" target="_blank">Are you an Agent? Register here</a>
        </div>
    </div>

    <!-- First Carousel Section -->
    <div class="carousel-container">
        <div class="carousel-row" id="carouselRow1"></div>
    </div>

    <!-- Space between the two carousels -->
    <div style="height: 20px;"></div>

    <!-- Second Carousel Section -->
    <div class="carousel-container">
        <div class="carousel-row reverse" id="carouselRow2"></div>
    </div>

    <div class="results-container">
        <div class="results" id="results"></div>
    </div>

    <div id="agentModal" class="modal">
        <div class="modal-content" onclick="event.stopPropagation();">
            <img id="modalImg" src="" alt="Agent Image">
            <div id="agentDetails" class="agent-details">
                <p id="modalName"></p>
                <p id="modalAgency"></p>
                <p id="modalEmail"></p>
                <p id="modalAboutMe"></p>
                <p id="modalSweetSpot"></p>
                <button id="messageBtn" class="message-btn" onclick="sendMessage()">Send a Message</button>
            </div>
        </div>
    </div>

    <div id="noResultsModal" class="modal">
        <div class="no-results-modal-content">
            <p>Unfortunately, there are no agents registered in your area (please make sure you have typed a location and not a postcode).</p>
            <button class="close-btn" onclick="closeModal()">OK</button>
        </div>
    </div>

    <script>
function searchAgents() {
    const location = document.getElementById('location').value;
    fetch(`/search?location=${encodeURIComponent(location)}`)
        .then(response => response.json())
        .then(data => {
            const resultsDiv = document.getElementById('results');
            if (data.length === 0) {
                openNoResultsModal();  // Show the modal if no results are found
            } else {
                resultsDiv.innerHTML = data.map(agent => {
                    const formattedAboutMe = (agent.aboutMe || '').replace(/\n/g, '<br>');
                    return `
                        <div class="result-item" 
                             data-photo="${encodeURIComponent(agent.photo || '')}" 
                             data-name="${encodeURIComponent(agent.name || '')}" 
                             data-agency="${encodeURIComponent(agent.agency || '')}" 
                             data-email="${encodeURIComponent(agent.email || '')}" 
                             data-aboutme="${encodeURIComponent(formattedAboutMe)}" 
                             data-sweetspot="${encodeURIComponent(agent.sweetSpot || '')}" 
                             onclick="openAgentModal(this)">
                            <img src="${agent.photo}" alt="${agent.name}">
                            <p><strong>Name:</strong> ${agent.name}</p>
                            <p><strong>Agency:</strong> ${agent.agency}</p>
                            <p><strong>Email:</strong> ${agent.email}</p>
                            <p class="about-me"><strong>About Me:</strong> ${formattedAboutMe}</p>
                            <p><strong>Sweet Spot:</strong> ${agent.sweetSpot}</p>
                        </div>
                    `;
                }).join('');
            }
        })
        .catch(error => {
            console.error('Error fetching data:', error);
            openNoResultsModal();  // Open the modal if there's an error with the fetch
        });
}

function openAgentModal(element) {
    const photo = decodeURIComponent(element.getAttribute('data-photo'));
    const name = decodeURIComponent(element.getAttribute('data-name'));
    const agency = decodeURIComponent(element.getAttribute('data-agency'));
    const email = decodeURIComponent(element.getAttribute('data-email'));
    const aboutMe = decodeURIComponent(element.getAttribute('data-aboutme'));
    const sweetSpot = decodeURIComponent(element.getAttribute('data-sweetspot'));

    document.getElementById('modalImg').src = photo;
    document.getElementById('modalName').innerHTML = `<strong>Name:</strong> ${name}`;
    document.getElementById('modalAgency').innerHTML = `<strong>Agency:</strong> ${agency}`;
    document.getElementById('modalEmail').innerHTML = `<strong>Email:</strong> ${email}`;
    document.getElementById('modalAboutMe').innerHTML = `<strong>About Me:</strong> ${aboutMe}`;
    document.getElementById('modalSweetSpot').innerHTML = `<strong>Sweet Spot:</strong> ${sweetSpot}`;

    document.getElementById('messageBtn').setAttribute('onclick', `sendMessage('${email}')`);

    document.getElementById('agentModal').style.display = 'block';
}

function sendMessage(email) {
    // Trigger the email client
    window.location.href = `mailto:${email}`;
}

function openNoResultsModal() {
    document.getElementById('noResultsModal').style.display = 'block';
}

function closeModal() {
    document.getElementById('agentModal').style.display = 'none';
    document.getElementById('noResultsModal').style.display = 'none';
}


// Close the modal when clicking outside of it
document.getElementById('agentModal').addEventListener('click', closeModal);

document.addEventListener('DOMContentLoaded', function() {
    fetch('/carousel-agents')
        .then(response => response.json())
        .then(data => {
            const carouselRow1 = document.getElementById('carouselRow1');
            const carouselRow2 = document.getElementById('carouselRow2');

            const reversedData = [...data].reverse();

            // Populate the first carousel
            data.forEach(agent => {
                const item = document.createElement('div');
                item.className = 'carousel-item';
                item.innerHTML = `<img src="${agent.photo}" alt="Agent Image">`;
                carouselRow1.appendChild(item);
            });

            // Duplicate items for infinite scrolling on the first carousel
            data.forEach(agent => {
                const item = document.createElement('div');
                item.className = 'carousel-item';
                item.innerHTML = `<img src="${agent.photo}" alt="Agent Image">`;
                carouselRow1.appendChild(item);
            });

            // Populate the second carousel in reverse order
            reversedData.forEach(agent => {
                const item = document.createElement('div');
                item.className = 'carousel-item';
                item.innerHTML = `<img src="${agent.photo}" alt="Agent Image">`;
                carouselRow2.appendChild(item);
            });

            // Duplicate items for infinite scrolling on the second carousel
            reversedData.forEach(agent => {
                const item = document.createElement('div');
                item.className = 'carousel-item';
                item.innerHTML = `<img src="${agent.photo}" alt="Agent Image">`;
                carouselRow2.appendChild(item);
            });
        })
        .catch(error => console.error('Error fetching carousel data:', error));
});
    </script>
</body>
</html>
